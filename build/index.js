(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.i18n,r=window.wp.data,l=window.wp.apiFetch;var a=e.n(l);const{useEffect:o,useState:c}=wp.element,{Card:i,CardHeader:s,CardBody:d,CardFooter:u,CheckboxControl:m,ExternalLink:k,TextControl:h}=wp.components;function p(){const[e,l]=c([]),[u,p]=c([]),b=(0,r.useSelect)((e=>e("core/block-editor").getBlocks())),f=(0,r.useSelect)((e=>e("core/block-editor").getBlockCount()));o((()=>{const e=b.map((e=>({clientId:e.clientId,name:e.name,htmlContent:wp.blocks.getBlockContent(e)})));p(e)}),[b,f]),o((()=>{w()}),[u]);const w=async()=>{if(!u)return;const e=u.flatMap((e=>{const t=e.clientId,n=e.htmlContent||"",r=(new DOMParser).parseFromString(n,"text/html");return Array.from(r.querySelectorAll("a")).map((async(e,n)=>({id:`${t}/${n}`,href:e.href,innerText:e.innerText,blockId:t,targetBlank:e.attributes.target?e.attributes.target.value:"",status:await E(e.href)})))})),t=await Promise.all(e.flat());l(t)},E=e=>a()({url:`${simpleLinkChecker.apiUrl}simple-link-checker/v1/check-link?url=${encodeURIComponent(e)}`,method:"GET"}).then((e=>e.status)).catch((e=>`Error: ${e.message}`)),g=(t,n)=>{const r=[...e],a=r.find((e=>e.id===t));a&&(n.href&&(a.href=n.href),void 0!==n.blank&&(a.targetBlank=n.blank?"_blank":void 0),l(r),C(a))},C=e=>{const t=(0,r.select)("core/block-editor").getBlock(e.blockId);if(t){const n=t.attributes.content||"",l=(new DOMParser).parseFromString(n,"text/html");l.querySelectorAll("a").forEach(((t,n)=>{n===parseInt(e.id.split("/")[1])&&(t.setAttribute("href",e.href),t.setAttribute("target",e.targetBlank))}));const a=l.body.innerHTML;(0,r.dispatch)("core/block-editor").updateBlockAttributes(e.blockId,{content:a}),(0,r.dispatch)("core/block-editor").flashBlock(e.blockId)}};return(0,t.createElement)("div",null,(0,t.createElement)("h3",null,(0,n.__)("Outbound Links","simple-link-checker")),e.map((e=>(0,t.createElement)("div",{key:e.id,style:{marginBottom:"1rem"}},(0,t.createElement)(i,null,(0,t.createElement)(s,null,(0,t.createElement)("div",null,(0,t.createElement)("span",null,(0,n.__)("Link"),": ",(0,t.createElement)(k,{href:e.href},e.innerText)),(0,t.createElement)("br",null),(0,t.createElement)("span",null,(0,n.__)("Status")," ",e.status))),(0,t.createElement)(d,null,(0,t.createElement)(h,{value:e.href,onChange:t=>g(e.id,{href:t})}),(0,t.createElement)(m,{label:(0,n.__)("Open in new tab"),checked:"_blank"===e.targetBlank,onChange:t=>g(e.id,{blank:t})})))))))}const{render:b}=wp.element;window.addEventListener("load",(function(){b((0,t.createElement)(p,null),document.getElementById("simple-link-checker-app"))}),!1)})();