(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.i18n,l=window.wp.data,r=window.wp.apiFetch;var o=e.n(r);const a=({statusCode:e})=>{const n={display:"inline-block",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold",color:"white",backgroundColor:(l=e,l>=200&&l<300?"green":l>=300&&l<400?"blue":l>=400&&l<500?"orange":l>=500?"red":"gray")};var l;return(0,t.createElement)("span",{style:n},e)},{useEffect:c,useState:i}=wp.element,{Button:s,Card:d,CardHeader:u,CardBody:m,CardFooter:k,CheckboxControl:p,ExternalLink:h,Flex:b,FlexBlock:f,FlexItem:E,TextControl:w}=wp.components;function g({postId:e}){const[r,k]=i([]),[g,y]=i([]),_=(0,l.useSelect)((e=>e("core/block-editor").getBlocks())),I=(0,l.useSelect)((e=>e("core/block-editor").getBlockCount()));c((()=>{const e=_.map((e=>({clientId:e.clientId,name:e.name,htmlContent:wp.blocks.getBlockContent(e)})));y(e)}),[_,I]),c((()=>{v()}),[g]);const v=async()=>{if(!g)return;const e=g.flatMap((e=>{const t=e.clientId,n=e.htmlContent||"",l=(new DOMParser).parseFromString(n,"text/html");return Array.from(l.querySelectorAll("a")).map((async(e,n)=>{const l=`${t}/${n}`,o=e.href,a=null!==e.querySelector("img"),c=r.find((e=>e.id===l)),i=await C(c?.href,o,c?.status);return console.log(e.attributes),{id:l,href:o,innerText:e.innerText,blockId:t,targetBlank:e.attributes.target?e.attributes.target.value:"",noFollow:e.attributes.rel?e.attributes.rel.value:"",status:i,isImageLink:a}}))})),t=await Promise.all(e.flat());k(t)},C=async(e,t,n)=>{return e!==t?await(l=t,o()({url:`${simpleLinkChecker.apiUrl}simple-link-checker/v1/check-link?url=${encodeURIComponent(l)}`,method:"GET"}).then((e=>e.status)).catch((e=>`Error: ${e.message}`))):n;var l},B=async(e,t)=>{const n=[...r],l=n.find((t=>t.id===e));l&&(t.href&&(l.status=await C(l.href,t.href,l.status),l.href=t.href),void 0!==t.blank&&(l.targetBlank=t.blank?"_blank":void 0),void 0!==t.rel&&(l.noFollow=t.rel?"nofollow":void 0),k(n),x(l))},x=e=>{const t=(0,l.select)("core/block-editor").getBlock(e.blockId);if(t){const n=t.attributes.content||"",r=(new DOMParser).parseFromString(n,"text/html");r.querySelectorAll("a").forEach(((t,n)=>{n===parseInt(e.id.split("/")[1])&&(t.setAttribute("href",e.href),t.setAttribute("target",e.targetBlank),t.setAttribute("rel",e.noFollow))}));const o=r.body.innerHTML;(0,l.dispatch)("core/block-editor").updateBlockAttributes(e.blockId,{content:o}),(0,l.dispatch)("core/block-editor").flashBlock(e.blockId)}};return(0,t.createElement)("div",null,(0,t.createElement)("h3",null,(0,n.__)("Outbound Links","simple-link-checker")),r.map((e=>(0,t.createElement)("div",{key:e.id,style:{marginBottom:"1rem"}},(0,t.createElement)(d,null,(0,t.createElement)(u,null,(0,t.createElement)(b,null,(0,t.createElement)(E,null,(0,t.createElement)(a,{statusCode:e.status})),(0,t.createElement)(f,null,(0,t.createElement)(h,{href:e.href},e.isImageLink?(0,n.__)("Image: ","simple-link-checker"):"",e.innerText||(0,n.__)("(No text)","simple-link-checker"))),(0,t.createElement)(E,null,(0,t.createElement)(s,{variant:"primary",onClick:()=>{return t=e.blockId,void setTimeout((()=>{const e=document.querySelector(`[data-block="${t}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),(0,l.dispatch)("core/block-editor").flashBlock(t))}),100);var t}},(0,n.__)("Scroll to Block","simple-link-checker"))))),(0,t.createElement)(m,null,(0,t.createElement)(w,{value:e.href,onChange:t=>B(e.id,{href:t}),label:(0,n.__)("Edit Link")}),(0,t.createElement)(p,{label:(0,n.__)("Open in new tab"),checked:"_blank"===e.targetBlank,onChange:t=>B(e.id,{blank:t})}),(0,t.createElement)(p,{label:(0,n.__)("Mark as nofollow"),checked:e.noFollow.includes("nofollow"),onChange:t=>B(e.id,{rel:t})})))))))}const{useEffect:y,useState:_}=wp.element,{Card:I,CardBody:v}=wp.components;function C({postId:e}){const[l,r]=_([]),[a,c]=_(!0);y((()=>{i()}),[e]);const i=async()=>{try{const t=await o()({url:`${simpleLinkChecker.apiUrl}simple-link-checker/v1/inbound-links/?post_id=${e}`,method:"GET"});r(t),c(!1)}catch(e){console.error("Error fetching inbound links:",e),c(!1)}};return a?(0,t.createElement)("p",null,"Loading inbound links..."):(0,t.createElement)("div",null,(0,t.createElement)("h3",null,(0,n.__)("Inbound Links","simple-link-checker")),(0,t.createElement)(I,null,(0,t.createElement)(v,null,0===l.length?(0,t.createElement)("p",null,(0,n.__)("No inbound links found.","simple-link-checker")):(0,t.createElement)("ul",null,l.map((e=>(0,t.createElement)("li",{key:e.ID},(0,t.createElement)("a",{href:`/wp-admin/post.php?post=${e.ID}&action=edit`,target:"_blank",rel:"noopener noreferrer"},e.post_title," (",e.post_type,")"))))))))}function B({postId:e}){return(0,t.createElement)("div",null,(0,t.createElement)(g,{postId:e}),(0,t.createElement)(C,{postId:e}))}const{render:x}=wp.element;window.addEventListener("load",(function(){const e=document.getElementById("simple-link-checker-app");if(e){const n=e.getAttribute("data-post-id");x((0,t.createElement)(B,{postId:n}),e)}}),!1)})();