(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.i18n,r=window.wp.data,l=window.wp.apiFetch;var o=e.n(l);const a=({statusCode:e})=>{const n={display:"inline-block",padding:"4px 8px",borderRadius:"4px",fontWeight:"bold",color:"white",backgroundColor:(r=e,r>=200&&r<300?"green":r>=300&&r<400?"blue":r>=400&&r<500?"orange":r>=500?"red":"gray")};var r;return(0,t.createElement)("span",{style:n},e)},{useEffect:c,useState:i}=wp.element,{Card:s,CardHeader:d,CardBody:u,CardFooter:k,CheckboxControl:m,ExternalLink:h,TextControl:b}=wp.components;function p(){const[e,l]=i([]),[k,p]=i([]),f=(0,r.useSelect)((e=>e("core/block-editor").getBlocks())),w=(0,r.useSelect)((e=>e("core/block-editor").getBlockCount()));c((()=>{const e=f.map((e=>({clientId:e.clientId,name:e.name,htmlContent:wp.blocks.getBlockContent(e)})));p(e)}),[f,w]),c((()=>{g()}),[k]);const g=async()=>{if(!k)return;const t=k.flatMap((t=>{const n=t.clientId,r=t.htmlContent||"",l=(new DOMParser).parseFromString(r,"text/html");return Array.from(l.querySelectorAll("a")).map((async(t,r)=>{const l=`${n}/${r}`,o=t.href,a=e.find((e=>e.id===l)),c=await E(a?.href,o,a?.status);return{id:l,href:o,innerText:t.innerText,blockId:n,targetBlank:t.attributes.target?t.attributes.target.value:"",noFollow:t.attributes.rel?t.attributes.rel.value:"",status:c}}))})),n=await Promise.all(t.flat());l(n)},E=async(e,t,n)=>{return e!==t?await(r=t,o()({url:`${simpleLinkChecker.apiUrl}simple-link-checker/v1/check-link?url=${encodeURIComponent(r)}`,method:"GET"}).then((e=>e.status)).catch((e=>`Error: ${e.message}`))):n;var r},v=async(t,n)=>{const r=[...e],o=r.find((e=>e.id===t));o&&(n.href&&(o.status=await E(o.href,n.href,o.status),o.href=n.href),void 0!==n.blank&&(o.targetBlank=n.blank?"_blank":void 0),void 0!==n.rel&&(o.noFollow=n.rel?"nofollow":void 0),l(r),C(o))},C=e=>{const t=(0,r.select)("core/block-editor").getBlock(e.blockId);if(t){const n=t.attributes.content||"",l=(new DOMParser).parseFromString(n,"text/html");l.querySelectorAll("a").forEach(((t,n)=>{n===parseInt(e.id.split("/")[1])&&(t.setAttribute("href",e.href),t.setAttribute("target",e.targetBlank),t.setAttribute("rel",e.noFollow))}));const o=l.body.innerHTML;(0,r.dispatch)("core/block-editor").updateBlockAttributes(e.blockId,{content:o}),(0,r.dispatch)("core/block-editor").flashBlock(e.blockId)}};return(0,t.createElement)("div",null,(0,t.createElement)("h3",null,(0,n.__)("Outbound Links","simple-link-checker")),e.map((e=>(0,t.createElement)("div",{key:e.id,style:{marginBottom:"1rem"}},(0,t.createElement)(s,null,(0,t.createElement)(d,null,(0,t.createElement)("div",null,(0,t.createElement)("p",null,(0,t.createElement)(h,{href:e.href},e.innerText)),(0,t.createElement)("p",null,(0,t.createElement)(a,{statusCode:e.status})),(0,t.createElement)("p",null,(0,t.createElement)("button",{onClick:()=>{return t=e.blockId,void setTimeout((()=>{const e=document.querySelector(`[data-block="${t}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),(0,r.dispatch)("core/block-editor").flashBlock(t))}),100);var t}},(0,n.__)("Scroll to Block","simple-link-checker"))))),(0,t.createElement)(u,null,(0,t.createElement)(b,{value:e.href,onChange:t=>v(e.id,{href:t})}),(0,t.createElement)(m,{label:(0,n.__)("Open in new tab"),checked:"_blank"===e.targetBlank,onChange:t=>v(e.id,{blank:t})}),(0,t.createElement)(m,{label:(0,n.__)("Mark as nofollow"),checked:"nofollow"===e.noFollow,onChange:t=>v(e.id,{rel:t})})))))))}const{render:f}=wp.element;window.addEventListener("load",(function(){f((0,t.createElement)(p,null),document.getElementById("simple-link-checker-app"))}),!1)})();